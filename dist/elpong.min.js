!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("elpong",[],t):"object"==typeof exports?exports.elpong=t():e.elpong=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=25)}([function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();if(Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof o)var o=!0;if(o)var i={schmnf:"Scheme not found",collnf:"Collection not found","collnf:s":"Collection not found by singular name",collex:"Collection with name already exists in scheme",elpgns:"No scheme tags found",elpnce:"No collection or element tags found",elndoc:"No document",confns:"Configuration has no selector",confnn:"Configuration has no name",elenew:"Element is new",elesna:"Element has a selector value but is in new_elements array",elense:"Element has no selector value but is in elements object",apinur:"Api url has not yet been set",fldnsa:"Field should be an array of selectors",elesch:"Element selector changed",elesnf:"Snapshot not found",elesti:"Invalid snapshot identifier: must be number <= list.length, string or RegExp",eleafw:"Pre element has an reference field that does not match the embedded element selector",elesnm:"Selector is not matching get one request selector",elenos:"No selector value given in getOne action",ajahct:"Content-Type header not set to application/json",acgtda:"GET request can't have data. Use params"};var l=function(e){function t(t,n){var r=this,l=o?i[t]:t;return r=n?e.call(this,l+": "+n)||this:e.call(this,l)||this}return r(t,e),t}(Error);t.ElpongError=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Util={capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){return e.replace(/_/g," ").replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},removeFromArray:function(e,t){var n=e.indexOf(t);return n!==-1&&(e.splice(n,n+1),!0)},isInteger:function(e){return e===parseInt(e,10)},isNumber:function(e){return isFinite(e)&&!isNaN(parseFloat(e))},isString:function(e){return"string"==typeof e},isRegExp:function(e){return"[object RegExp]"==Object.prototype.toString.call(e)},forEach:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t(r,n)}},endsWith:function(e,t){return e.endsWith?e.endsWith(t):e.substr(-t.length)===t},startsWith:function(e,t){return e.startsWith?e.startsWith(t):e.substr(0,t.length)===t},arrayFromHTML:function(e){return Array.from?Array.from(e):[].slice.call(e)},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e.propertyIsEnumerable(n)&&t.push(e[n]);return t},includes:function(e,t){return e.indexOf(t)>-1},equalsJSON:function(e,n){for(var r in e){var o=e[r],i=n[r];if("object"==typeof o){if(!t.Util.equalsJSON(o,i))return!1}else if(o!==i)return!1}return!0},copyJSON:function(e){return JSON.parse(JSON.stringify(e))}}},function(e,t,n){"use strict";function r(e){return!(!e&&0!==e&&""!==e||"string"!=typeof e&&"number"!=typeof e)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(20),l=n(21),s=n(19),a=n(24),c=n(15),u=n(14),f=n(0);t.isSelectorValue=r;var p=function(){function e(e,t){this.fields={},this.relations={},this.actions={},this.snapshots={},this._collection=e;var n=e.configuration();i.Fields.setup(this,n.fields,t),l.Relations.setup(this,n.relations),s.Actions.setup(this,n.actions),a.Snapshots.setup(this),this.snapshots.make("creation")}return e.prototype.collection=function(){return this._collection},e.prototype.selector=function(){return this.fields[this.collection().scheme().configuration().selector]},e.prototype.remove=function(){var e=this,t=this.selector();return void 0!==t?this.actions["delete"]().then(function(){var n=e.collection().elements;n["delete"](t)}):(o.Util.removeFromArray(this.collection().new_elements,this),{then:function(e){return e()},"catch":function(){}})},e.prototype.save=function(){return this.isNew()?this.actions.post():this.actions.put()},e.prototype.isNew=function(){if(o.Util.includes(this.collection().new_elements,this)){if(this.selector())throw new f.ElpongError("elesna");return!0}if(this.selector())return!1;throw new f.ElpongError("elense")},e.prototype.merge=function(e){var t=this,n=this.collection().configuration(),i=this.collection().scheme().configuration().selector;return o.Util.forEach(n.fields,function(n,o){var l;if(l=e[o])if(n.embedded_element)c.EmbeddedElement.handle(t,e,o,n);else if(n.embedded_collection)u.EmbeddedCollection.handle(t,e,o,n);else if(o===i){var s=t.fields[o];if(s!==l&&r(s)&&r(l))throw new f.ElpongError("elesch",s+" -> "+l);t.fields[o]=l}else t.fields[o]=l}),this},e}();t.Element=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){return e.scheme().configuration().collections[e.name]}function n(e){return t(e).singular}function r(e,t){var n=t.selector();void 0!==n?e.elements.set(n,t):e.new_elements.push(t)}e.getConfiguration=t,e.getSingularName=n,e.addElement=r}(r=t.CollectionHelper||(t.CollectionHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0);!function(e){function t(e,t,n,o){o||(o={}),o.Accept=o["Content-Type"]="application/json";var i=JSON.stringify(void 0===n?{}:n),l={method:t,type:t,url:e,data:i,body:i,headers:o,dataType:"json",responseType:"json"};return r(l.url,l)}function n(e,t){switch("undefined"==typeof t&&("undefined"!=typeof jQuery&&e===jQuery.ajax?t="jquery":"undefined"!=typeof fetch&&e===fetch&&(t="fetch")),t){case"jquery":r=function(t,n){var r=jQuery.Deferred(),o=e(t,n);return o.then(function(e,t,n){return r.resolve({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),o["catch"](function(e,t,n){return r.reject({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),r.promise()};break;case"fetch":r=function(t,n){return new Promise(function(r,i){n.body="GET"===n.method?void 0:n.data;var l=e(t,n);l.then(function(e){if(204===e.status)r(e);else{var t=e.headers.get("content-type");if(!t||t.indexOf("json")<0)throw new o.ElpongError("ajahct");var n=e.json();n.then(function(t){e.data=t,r(e)}),n["catch"](i)}}),l["catch"](i)})};break;case"angular2":r=function(t,n){return new Promise(function(r,o){n.responseType=void 0,n.observe = 'response',e.request.bind(e)(n.method,t,n).subscribe(function(e){if(204===e.status)r(e);else{var t=e.headers.get("content-type");if(!t||t.indexOf("json")<0)throw new Error("ajahct");var n=e.json();e.data=n,r(e)}},function(e){o(e)})})};break;default:r=function(t,n){return e(n)}}}var r;e.executeRequest=t,e.setAjaxFunction=n}(r=t.Ajax||(t.Ajax={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0),i=n(3);!function(e){function t(e,t){for(var n=0,r=e.getCollectionMap().values();n<r.length;n++){var l=r[n];if(i.CollectionHelper.getSingularName(l)===t)return l}throw new o.ElpongError("collnf:s",t)}e.getCollectionBySingularName=t}(r=t.SchemeHelper||(t.SchemeHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0);!function(e){function t(e,t){var n,r=e.collection(),i=r.scheme(),s=i.getApiUrl();if(!s)throw new o.ElpongError("apinur");return n=s+"/"+r.name,t.no_selector||(n=n+"/"+e.selector()),t.suffix&&(n=n+"/"+t.suffix),t.params&&(n=l(n,t.params)),n}function n(e,t){var n=e.scheme().getApiUrl();if(!n)throw new o.ElpongError("apinur");var r=n+"/"+e.name;return t.suffix&&(r=r+"/"+t.suffix),t.params&&(r=l(r,t.params)),r}function r(e){return e.replace(/^\/|\/$/g,"")}function i(e){return/^https?:\/\//.test(e)}function l(e,t){e+="?";for(var n in t)e=""+e+n+"="+encodeURIComponent(t[n])+"&";return e=e.slice(0,-1)}e.createForElement=t,e.createForCollection=n,e.trimSlashes=r,e.isFqdn=i,e.appendParamsToUrl=l}(r=t.UrlHelper||(t.UrlHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=n(2),i=n(1),l=n(18),s=n(0),a=n(12),c=function(){function e(e,t){var n=this;this.default_pre_element={},this.elements=new a.FakeMap,this.new_elements=[],this._scheme=e,this.name=t;var o=r.CollectionHelper.getConfiguration(this);for(var c in o.fields){var u=o.fields[c];u["default"]&&(this.default_pre_element[c]=u["default"])}this.actions={getAll:function(e){return l.CollectionActions.executeGetAll(n,e)},getOne:function(e,t){if(void 0===e)throw new s.ElpongError("elenos");return l.CollectionActions.executeGetOne(n,e,t)}},i.Util.forEach(o.collection_actions,function(e,t){n.actions[i.Util.camelize(t)]=function(r){return void 0===r&&(r={}),l.CollectionActions.executeCustom(n,t,e,r)}})}return e.prototype.scheme=function(){return this._scheme},e.prototype.load=function(e){var t=this;if("undefined"==typeof document)throw new s.ElpongError("elndoc");var n=document.querySelectorAll("meta[name=elpong-collection][collection='"+this.name+"'][scheme='"+this.scheme().name+"']"),r=document.querySelectorAll("meta[name=elpong-element][collection='"+this.name+"'][scheme='"+this.scheme().name+"']");if(!e&&!n.length&&!r.length)throw new s.ElpongError("elpnce");for(var o=0,l=i.Util.arrayFromHTML(n);o<l.length;o++)for(var a=l[o],c=0,u=JSON.parse(a.content);c<u.length;c++){var f=u[c];this.buildOrMerge(f)}i.Util.arrayFromHTML(r).map(function(e){return t.buildOrMerge(JSON.parse(e.content))})},e.prototype.configuration=function(){return r.CollectionHelper.getConfiguration(this)},e.prototype.array=function(e){e||(e={no_new:!1});var t=e.no_new?[]:this.new_elements;return t.concat(this.elements.values())},e.prototype.find=function(e){return this.elements.get(e)||null},e.prototype.findBy=function(e,t){t||(t={});for(var n,r=this.array(t),o=[],i=0,l=r;i<l.length;i++){var s=l[i];n=!0;for(var a in e){var c=e[a];if(s.fields[a]!==c){n=!1;break}}if(n){if(!t.multiple)return s;o.push(s)}}return t.multiple?o:null},e.prototype.build=function(e){e||(e=this.default_pre_element);var t=new o.Element(this,e);return r.CollectionHelper.addElement(this,t),t},e.prototype.buildOrMerge=function(e){var t;if(t=e[this.scheme().configuration().selector]){var n=void 0;return(n=this.find(t))?n.merge(e):this.build(e)}return this.build(e)},e}();t.Collection=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);if("undefined"==typeof o)var o=!0;var i=function(){function e(e){if(this.name=e.name,o&&!this.name)throw new r.ElpongError("confnn");if(this.selector=e.selector,o&&!this.selector)throw new r.ElpongError("confns",e.name);this.collections={};for(var t in e.collections){for(var n=e.collections[t],i=this.collections[t]={singular:n.singular||t.slice(0,-1)},l=["fields","relations","actions","collection_actions"],s=["has_many","has_one","belongs_to"],a=0,c=l;a<c.length;a++){var u=c[a];i[u]=n[u]||{}}var f=void 0;if(f=n.relations)for(var p=0,d=s;p<d.length;p++){var h=d[p];f[h]=n.relations[h]||{}}}}return e}();t.SchemeConfiguration=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(10),i=n(0),l=n(1),s=n(4),a={},c=!1;!function(e){function t(e){var t=new o.Scheme(e);return a[t.name]=t}function n(e){var t;if(t=a[e])return t;throw new i.ElpongError("schmnf",e)}function r(t){if("undefined"!=typeof document){var n=document.querySelectorAll("meta[name=elpong-scheme]");if(!t&&!n.length)throw new i.ElpongError("elpgns");for(var r=0,o=l.Util.arrayFromHTML(n);r<o.length;r++){var s=o[r];e.add(JSON.parse(s.content))}}}function u(e,t){s.Ajax.setAjaxFunction(e,t)}function f(){c=!0,e.load(!0)}function p(){return c}function d(){c=!1,a={}}e.add=t,e.get=n,e.load=r,e.setAjax=u,e.enableAutoload=f,e.isAutoloadEnabled=p,e.tearDown=d}(r=t.Elpong||(t.Elpong={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(8),i=n(0),l=n(13),s=n(9),a=n(12),c=function(){function e(e){this._collections=new a.FakeMap;var t=new o.SchemeConfiguration(e);this._configuration=t,this.name=t.name;for(var n in t.collections){var i=(t.collections[n],new r.Collection(this,n));this._collections.set(n,i)}if(s.Elpong.isAutoloadEnabled())for(var n in t.collections)this._collections.get(n).load(!0)}return e.prototype.configuration=function(){return this._configuration},e.prototype.select=function(e){var t;if(t=this._collections.get(e))return t;throw new i.ElpongError("collnf",e)},e.prototype.setApiUrl=function(e){var t=l.UrlHelper.trimSlashes(e);return this._api_url=l.UrlHelper.isFqdn(t)?t:"/"+t},e.prototype.getApiUrl=function(){return this._api_url},e.prototype.getCollectionMap=function(){return this._collections},e}();t.Scheme=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),o=function(){function e(e,t){this.element=e,this.tag=t,this.data=r.ElementHelper.toData(e,!0),this.undone=!1,this.time=Date.now(),this.index=e.snapshots.list.length,e.snapshots.list.push(this),e.snapshots.current_index=this.index}return e.prototype.revert=function(){var e=this.element.snapshots.list;this.element.merge(this.data),this.element.snapshots.current_index=this.index,this.undone=!1;for(var t=this.index+1,n=e.length;t<n;t++)e[t].undone=!0},e}();t.Snapshot=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o="undefined"!=typeof Map&&(new Map).values,i=function(){function e(){this.hasRealMap=o,this.map=o?new Map:{}}return e.prototype.get=function(e){return o?this.map.get(e):this.map[e]},e.prototype.set=function(e,t){return o?this.map.set(e,t):this.map[e]=t,this},e.prototype.has=function(e){return o?this.map.has(e):!!this.map[e]},e.prototype.values=function(){return o?Array.from(this.map.values()):r.Util.values(this.map)},e.prototype["delete"]=function(e){o?this.map["delete"](e):delete this.map[e]},e}();t.FakeMap=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.UrlHelper=r.UrlHelper;var o=n(3);t.CollectionHelper=o.CollectionHelper},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(1),l=n(3);!function(e){function t(e,t,n,r){var s;if(s=t[n]){var a=e.collection(),c=a.scheme(),u=c.select(r.collection||n);i.Util.forEach(s,function(e){var t=new o.Element(u,e);l.CollectionHelper.addElement(u,t)})}}e.handle=t}(r=t.EmbeddedCollection||(t.EmbeddedCollection={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(5),i=n(0);!function(e){function t(e,t,n,r){var l,s=t[n];if(s){var a=e.collection(),c=a.scheme();l=r.collection?c.select(r.collection):o.SchemeHelper.getCollectionBySingularName(c,n);var u=l.buildOrMerge(s),f=r.reference_field||n+"_"+c.configuration().selector,p=a.configuration().fields[f];if(p&&p.reference){var d=u.selector(),h=t[f];if(void 0!==h&&h!=d)throw new i.ElpongError("eleafw",h+" != "+d);e.fields[f]=d}}}e.handle=t}(r=t.EmbeddedElement||(t.EmbeddedElement={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(1),l=n(0);!function(e){function t(e,t,r){var o=e.collection(),l=(o.configuration(),o.scheme().select(r.collection||t));if(r.inline){var s=r.inline_field||t+"_"+o.scheme().configuration().selector+"s";return e.relations[i.Util.camelize(t)]=function(){return a(e,l,s)}}return e.relations[i.Util.camelize(t)]=n(e,o,r,l)}function n(e,t,n,i,l){var a,c=o.CollectionHelper.getSingularName(t),u=(i.configuration(),t.scheme().configuration().selector);if(n.polymorphic){a=n.as+"_"+u;var f=n.as+"_collection";return function(){return s(e,i,a,f,l)}}return a=n.field?n.field:n.as?n.as+"_"+u:c+"_"+u,function(){return r(e,i,a,l)}}function r(e,t,n,r){for(var o=[],i=e.selector(),l=0,s=t.array();l<s.length;l++){var a=s[l];if(i===a.fields[n]&&(o.push(a),r))return o}return o}function s(e,t,n,r,o){for(var i=[],l=e.selector(),s=e.collection().name,a=0,c=t.array();a<c.length;a++){var u=c[a];if(l===u.fields[n]&&s===u.fields[r]&&(i.push(u),o))return i}return i}function a(e,t,n){var r=e.fields[n];if(!Array.isArray(r))throw new l.ElpongError("fldnrf",n);for(var o=[],s=0,a=t.array();s<a.length;s++){var c=a[s];i.Util.includes(r,c.selector())&&o.push(c)}return o}e.setup=t,e.getHasManyRelationFunction=n}(r=t.HasMany||(t.HasMany={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1);!function(e){function t(e,t){var n=e.collection(),r=n.scheme(),i={},l=r.configuration().collections[n.name].fields;for(var s in l){var a=l[s];if(!(a.no_send||a.embedded_collection||a.embedded_element)){var c=e.fields[s];t&&"object"==typeof c?i[s]=o.Util.copyJSON(c):i[s]=c}}return i}e.toData=t}(r=t.ElementHelper||(t.ElementHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(4),i=n(6),l=n(0);!function(e){function t(e,t){if(void 0===t&&(t={}),t||(t={}),t.data)throw new l.ElpongError("acgtda");var n=o.Ajax.executeRequest(i.UrlHelper.createForCollection(e,{params:t.params||{}}),"GET",void 0,t.headers);return n.then(function(t){t.data.map(function(t){e.buildOrMerge(t)})}),n}function n(e,t,n){if(void 0===n&&(n={}),n.data)throw new l.ElpongError("acgtda");var r={suffix:t,params:n.params||{}},s=o.Ajax.executeRequest(i.UrlHelper.createForCollection(e,r),"GET",void 0,n.headers);return s.then(function(n){if(n.data){var r=e.scheme().configuration().selector;if(n.data[r]!==t)throw new l.ElpongError("elesnm",n.data[r]+" != "+t);e.buildOrMerge(n.data)}}),s}function r(e,t,n,r){r||(r={});var l=r.data,s=n.method.toUpperCase();return o.Ajax.executeRequest(i.UrlHelper.createForCollection(e,{suffix:n.path||t,params:r.params}),s,l,r.headers)}e.executeGetAll=t,e.executeGetOne=n,e.executeCustom=r}(r=t.CollectionActions||(t.CollectionActions={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(4),i=n(1),l=n(0),s=n(17),a=n(6);!function(e){function t(e,t){for(var o=function(t){e.actions[t]=function(r){return n(e,t.toUpperCase(),r)}},s=0,a=["get","post","put","delete"];s<a.length;s++){var c=a[s];o(c)}i.Util.forEach(t,function(t,n){e.actions[i.Util.camelize(n)]=function(o){if(e.isNew()&&!t.no_selector)throw new l.ElpongError("elenew");return r(e,n,t,o)}})}function n(e,t,n){void 0===n&&(n={}),e.snapshots.make("before_"+t.toLowerCase());var r;if(n.data){if("GET"===t)throw new l.ElpongError("acgtda");r=n.data}else"GET"!==t&&(r=s.ElementHelper.toData(e));if("POST"===t){if(!e.isNew())throw new Error("Element is not new")}else if(e.isNew())throw new Error("Element is new");var c={no_selector:"POST"===t,params:n.params||{}},u=o.Ajax.executeRequest(a.UrlHelper.createForElement(e,c),t,r,n.headers);return u.then(function(n){n.data&&e.merge(n.data),e.snapshots.make("after_"+t.toLowerCase());var r=e.collection();i.Util.includes(r.new_elements,e)&&(i.Util.removeFromArray(r.new_elements,e),r.elements.set(e.selector(),e))}),u}function r(e,t,n,r){void 0===r&&(r={});var c=n.method.toUpperCase();e.snapshots.make("before_"+t);var u;if(r.data){if("GET"===c)throw new l.ElpongError("acgtda");u=r.data}else n.no_data||(u=s.ElementHelper.toData(e));var f={suffix:n.path||t,params:r.params||{}};f.no_selector=n.no_selector;var p=o.Ajax.executeRequest(a.UrlHelper.createForElement(e,f),c,u,r.headers);return p.then(function(t){var r;n.returns_other||(t.data&&e.merge(t.data),e.snapshots.make("after_"+c.toLowerCase()));var o=e.collection();if((r=e.selector())&&i.Util.includes(o.new_elements,e))return i.Util.removeFromArray(o.new_elements,e),o.elements.set(r,e)}),p}e.setup=t,e.execute=n,e.executeCustom=r}(r=t.Actions||(t.Actions={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(15),l=n(14);!function(e){function t(e,t,n){o.Util.forEach(t,function(t,r){if(t.embedded_element)i.EmbeddedElement.handle(e,n,r,t);else if(t.embedded_collection)l.EmbeddedCollection.handle(e,n,r,t);else{if(!n.hasOwnProperty(r))return;var o=n[r];e.fields[r]=o}})}e.setup=t}(r=t.Fields||(t.Fields={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(16),l=n(23),s=n(22);!function(e){function t(e,t){o.Util.forEach(t.has_many,function(t,n){i.HasMany.setup(e,n,t)}),o.Util.forEach(t.has_one,function(t,n){l.HasOne.setup(e,n,t)}),o.Util.forEach(t.belongs_to,function(t,n){s.BelongsTo.setup(e,n,t)})}e.setup=t}(r=t.Relations||(t.Relations={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(1),l=n(5);!function(e){function t(e,t,o){var s,a,c=e.collection();if(o.polymorphic){var u=o.collection_field||t+"_collection";s=o.field,e.relations[i.Util.camelize(t)]=function(){return r(e,s,u,t)}}else{var f=c.scheme();a=o.collection?c.scheme().select(o.collection):l.SchemeHelper.getCollectionBySingularName(f,t),s=o.field||t+"_"+f.configuration().selector,e.relations[i.Util.camelize(t)]=function(){return n(e,a,s)}}}e.setup=t;var n=function(e,t,n){var r=e.fields[n];return o.isSelectorValue(r)?t.find(r)||null:void 0},r=function(e,t,n,r){var o=e.fields[n],i=e.collection().scheme().select(o);if(!t){var l=e.collection().scheme().configuration().selector;t=r+"_"+l}var s=e.fields[t];return i.find(s)||null}}(r=t.BelongsTo||(t.BelongsTo={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(16),i=n(5),l=n(1);!function(e){function t(e,t,n){var r,s=e.collection(),a=(e.collection().configuration(),s.scheme());return r=n.collection?a.select(n.collection):i.SchemeHelper.getCollectionBySingularName(a,t),e.relations[l.Util.camelize(t)]=function(){return o.HasMany.getHasManyRelationFunction(e,s,n,r,!0)()[0]}}e.setup=t}(r=t.HasOne||(t.HasOne={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(11),l=n(0);!function(e){function t(e){var t=e.snapshots;t.list=[],t.make=function(t){return new i.Snapshot(e,t)},t.lastPersisted=function(){if(!e.isNew())for(var n=t.list.length-1;n>=0;n--){var r=t.list[n];if(o.Util.includes(["after_post","after_put","after_get","creation"],r.tag))return r}},t.lastWithTag=function(t){var n,r=e.snapshots.list;if(o.Util.isRegExp(t))for(var i=r.length-1;i>=0;i--){var l=r[i];if(l.tag&&t.test(l.tag))return l}else for(var i=r.length-1;i>=0;i--){var l=r[i];if(t===l.tag)return l}return n},t.last=function(){var t=e.snapshots.list;return t[t.length-1]},t.undo=function(n){if(null==n&&(n=0),o.Util.isInteger(n)){var r=e.snapshots.list;if(n<0||n>r.length)throw new l.ElpongError("elesti",""+n);var i=r[e.snapshots.current_index-n];i.revert()}else{var i=void 0;if(!(i=t.lastWithTag(n)))throw new l.ElpongError("elesnf",""+n);i.revert()}return e},t.isPersisted=function(){var n=t.lastPersisted();return!!n&&o.Util.equalsJSON(e.fields,n.data)}}e.setup=t}(r=t.Snapshots||(t.Snapshots={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);t["default"]=r.Elpong;var o=n(10);t.Scheme=o.Scheme;var i=n(7);t.Collection=i.Collection;var l=n(2);t.Element=l.Element;var s=n(0);t.ElpongError=s.ElpongError;var a=n(11);t.Snapshot=a.Snapshot;var c=n(1);t.Util=c.Util;var u=n(8);t.SchemeConfiguration=u.SchemeConfiguration}])});
