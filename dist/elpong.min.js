!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("elpong",[],t):"object"==typeof exports?exports.elpong=t():e.elpong=t()}("undefined"!=typeof self?self:this,function(){return function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=13)}([function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});if(Object.defineProperty(t,"__esModule",{value:!0}),void 0===i)var i=!0;if(i)var l={schmnf:"Scheme not found",collnf:"Collection not found","collnf:s":"Collection not found by singular name",collex:"Collection with name already exists in scheme",elpgns:"No scheme tags found",elpnce:"No collection or element tags found",elndoc:"No document",confns:"Configuration has no selector",confnn:"Configuration has no name",elenew:"Element is new",elesna:"Element has a selector value but is in new_elements array",elense:"Element has no selector value but is in elements object",apinur:"Api url has not yet been set",fldnsa:"Field should be an array of selectors",elesch:"Element selector changed",elesnf:"Snapshot not found",elesti:"Invalid snapshot identifier: must be number <= list.length, string or RegExp",eleafw:"Pre element has an reference field that does not match the embedded element selector",elesnm:"Selector is not matching get one request selector",elenos:"No selector value given in getOne action",ajahct:"Content-Type header not set to application/json",acgtda:"GET request can't have data. Use params"};var s=function(r){function e(e,t){var n=i?l[e]:e;return t?r.call(this,n+": "+t)||this:r.call(this,n)||this}return o(e,r),e}(Error);t.ElpongError=s},function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Util={capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){return e.replace(/_/g," ").replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},removeFromArray:function(e,t){var n=e.indexOf(t);return-1!==n&&(e.splice(n,n+1),!0)},isInteger:function(e){return e===parseInt(e,10)},isNumber:function(e){return isFinite(e)&&!isNaN(parseFloat(e))},isString:function(e){return"string"==typeof e},isRegExp:function(e){return"[object RegExp]"==Object.prototype.toString.call(e)},forEach:function(e,t){for(var n in e){if(e.hasOwnProperty(n))t(e[n],n)}},endsWith:function(e,t){return e.endsWith?e.endsWith(t):e.substr(-t.length)===t},startsWith:function(e,t){return e.startsWith?e.startsWith(t):e.substr(0,t.length)===t},arrayFromHTML:function(e){return Array.from?Array.from(e):[].slice.call(e)},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e.propertyIsEnumerable(n)&&t.push(e[n]);return t},includes:function(e,t){return-1<e.indexOf(t)},equalsJSON:function(e,t){for(var n in e){var r=e[n],o=t[n];if("object"==typeof r){if(!i.Util.equalsJSON(r,o))return!1}else if(r!==o)return!1}return!0},copyJSON:function(e){return JSON.parse(JSON.stringify(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return e.scheme().configuration().collections[e.name]}e.getConfiguration=t,e.getSingularName=function(e){return t(e).singular},e.addElement=function(e,t){var n=t.selector();void 0!==n?e.elements.set(n,t):e.new_elements.push(t)}}(t.CollectionHelper||(t.CollectionHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n(0);!function(e){function i(e,t){for(var n in e+="?",t)e=""+e+n+"="+encodeURIComponent(t[n])+"&";return e=e.slice(0,-1)}e.createForElement=function(e,t){var n,r=e.collection(),o=r.scheme().getApiUrl();if(!o)throw new l.ElpongError("apinur");return n=o+"/"+r.name,t.no_selector||(n=n+"/"+e.selector()),t.suffix&&(n=n+"/"+t.suffix),t.params&&(n=i(n,t.params)),n},e.createForCollection=function(e,t){var n=e.scheme().getApiUrl();if(!n)throw new l.ElpongError("apinur");var r=n+"/"+e.name;return t.suffix&&(r=r+"/"+t.suffix),t.params&&(r=i(r,t.params)),r},e.trimSlashes=function(e){return e.replace(/^\/|\/$/g,"")},e.isFqdn=function(e){return/^https?:\/\//.test(e)},e.appendParamsToUrl=i}(t.UrlHelper||(t.UrlHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(16),i=n(17),l=n(20),s=n(21),a=n(9),c=n(10),u=n(0);function f(e){return!(!e&&0!==e&&""!==e||"string"!=typeof e&&"number"!=typeof e)}t.isSelectorValue=f;var p=function(){function e(e,t){this.fields={},this.relations={},this.actions={},this.snapshots={};var n=(this._collection=e).configuration();o.Fields.setup(this,n.fields,t),i.Relations.setup(this,n.relations),l.Actions.setup(this,n.actions),s.Snapshots.setup(this),this.snapshots.make("creation")}return e.prototype.collection=function(){return this._collection},e.prototype.selector=function(){return this.fields[this.collection().scheme().configuration().selector]},e.prototype.remove=function(){var e=this,t=this.selector();return void 0!==t?this.actions.delete().then(function(){e.collection().elements.delete(t)}):(r.Util.removeFromArray(this.collection().new_elements,this),{then:function(e){return e()},catch:function(){}})},e.prototype.save=function(){return this.isNew()?this.actions.post():this.actions.put()},e.prototype.isNew=function(){if(r.Util.includes(this.collection().new_elements,this)){if(this.selector())throw new u.ElpongError("elesna");return!0}if(this.selector())return!1;throw new u.ElpongError("elense")},e.prototype.merge=function(o){var i=this,e=this.collection().configuration(),l=this.collection().scheme().configuration().selector;return r.Util.forEach(e.fields,function(e,t){var n;if(n=o[t])if(e.embedded_element)a.EmbeddedElement.handle(i,o,t,e);else if(e.embedded_collection)c.EmbeddedCollection.handle(i,o,t,e);else if(t===l){var r=i.fields[t];if(r!==n&&f(r)&&f(n))throw new u.ElpongError("elesch",r+" -> "+n);i.fields[t]=n}else i.fields[t]=n}),this},e}();t.Element=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(2);(t.SchemeHelper||(t.SchemeHelper={})).getCollectionBySingularName=function(e,t){for(var n in e.getCollections()){var r=e.select(n);if(i.CollectionHelper.getSingularName(r)===t)return r}throw new o.ElpongError("collnf:s",t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,l,s=n(0);(r=t.Ajax||(t.Ajax={})).executeRequest=function(e,t,n,r){r||(r={}),r.Accept=r["Content-Type"]="application/json";var o=JSON.stringify(void 0===n?{}:n),i={method:t,type:t,url:e,data:o,body:o,headers:r,dataType:"json",responseType:"json"};return l(i.url,i)},r.setAjaxFunction=function(i,e){switch(void 0===e&&("undefined"!=typeof jQuery&&i===jQuery.ajax?e="jquery":"undefined"!=typeof fetch&&i===fetch&&(e="fetch")),e){case"jquery":l=function(e,t){var r=jQuery.Deferred(),n=i(e,t);return n.then(function(e,t,n){return r.resolve({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),n.catch(function(e,t,n){return r.reject({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),r.promise()};break;case"fetch":l=function(t,n){return new Promise(function(r,o){n.body="GET"===n.method?void 0:n.data;var e=i(t,n);e.then(function(t){if(204===t.status)r(t);else{var e=t.headers.get("content-type");if(!e||e.indexOf("json")<0)throw new s.ElpongError("ajahct");var n=t.json();n.then(function(e){t.data=e,r(t)}),n.catch(o)}}),e.catch(o)})};break;case"angular2":l=function(e,n){return new Promise(function(r,t){n.responseType=void 0,i.request.bind(i)(e,n).subscribe(function(e){if(204===e.status)r(e);else{var t=e.headers.get("content-type");if(!t||t.indexOf("json")<0)throw new Error("ajahct");var n=e.json();e.data=n,r(e)}},function(e){t(e)})})};break;default:l=function(e,t){return i(t)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(14),l=n(0),s=n(1),o=n(6),a={},c=!1;(i=t.Elpong||(t.Elpong={})).add=function(e){var t=new r.Scheme(e);return a[t.name]=t},i.get=function(e){var t;if(t=a[e])return t;throw new l.ElpongError("schmnf",e)},i.load=function(e){if("undefined"!=typeof document){var t=document.querySelectorAll("meta[name=elpong-scheme]");if(!e&&!t.length)throw new l.ElpongError("elpgns");for(var n=0,r=s.Util.arrayFromHTML(t);n<r.length;n++){var o=r[n];i.add(JSON.parse(o.content))}}},i.setAjax=function(e,t){o.Ajax.setAjaxFunction(e,t)},i.enableAutoload=function(){c=!0,i.load(!0)},i.isAutoloadEnabled=function(){return c},i.tearDown=function(){c=!1,a={}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.UrlHelper=r.UrlHelper;var o=n(2);t.CollectionHelper=o.CollectionHelper},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=n(5),d=n(0);(t.EmbeddedElement||(t.EmbeddedElement={})).handle=function(e,t,n,r){var o=t[n];if(o){var i=e.collection(),l=i.scheme(),s=(r.collection?l.select(r.collection):p.SchemeHelper.getCollectionBySingularName(l,n)).buildOrMerge(o),a=r.reference_field||n+"_"+l.configuration().selector,c=i.configuration().fields[a];if(c&&c.reference){var u=s.selector(),f=t[a];if(void 0!==f&&f!=u)throw new d.ElpongError("eleafw",f+" != "+u);e.fields[a]=u}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n(4),s=n(1),a=n(2);(t.EmbeddedCollection||(t.EmbeddedCollection={})).handle=function(e,t,n,r){var o;if(o=t[n]){var i=e.collection().scheme().select(r.collection||n);s.Util.forEach(o,function(e){var t=new l.Element(i,e);a.CollectionHelper.addElement(i,t)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=n(2),a=n(1),u=n(0);!function(e){function l(e,t,n,r,o){var i,l=c.CollectionHelper.getSingularName(t),s=(r.configuration(),t.scheme().configuration().selector);if(n.polymorphic){i=n.as+"_"+s;var a=n.as+"_collection";return function(){return function(e,t,n,r,o){for(var i=[],l=e.selector(),s=e.collection().name,a=0,c=t.array();a<c.length;a++){var u=c[a];if(l===u.fields[n]&&s===u.fields[r]&&(i.push(u),o))return i}return i}(e,r,i,a,o)}}return i=n.field?n.field:n.as?n.as+"_"+s:l+"_"+s,function(){return function(e,t,n,r){for(var o=[],i=e.selector(),l=0,s=t.array();l<s.length;l++){var a=s[l];if(i===a.fields[n]&&(o.push(a),r))return o}return o}(e,r,i,o)}}e.setup=function(e,t,n){var r=e.collection(),o=(r.configuration(),r.scheme().select(n.collection||t));if(n.inline){var i=n.inline_field||t+"_"+r.scheme().configuration().selector+"s";return e.relations[a.Util.camelize(t)]=function(){return function(e,t,n){var r=e.fields[n];if(!Array.isArray(r))throw new u.ElpongError("fldnrf",n);for(var o=[],i=0,l=t.array();i<l.length;i++){var s=l[i];a.Util.includes(r,s.selector())&&o.push(s)}return o}(e,o,i)}}return e.relations[a.Util.camelize(t)]=l(e,r,n,o)},e.getHasManyRelationFunction=l}(t.HasMany||(t.HasMany={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1);(t.ElementHelper||(t.ElementHelper={})).toData=function(e,t){var n=e.collection(),r={},o=n.scheme().configuration().collections[n.name].fields;for(var i in o){var l=o[i];if(!(l.no_send||l.embedded_collection||l.embedded_element)){var s=e.fields[i];r[i]=t&&"object"==typeof s?a.Util.copyJSON(s):s}}return r}},function(e,t,n){"use strict";var r=n(7);e.exports=r.Elpong},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),i=n(25),r=n(0),l=n(8),s=n(7),a=function(){function e(e){var t=new i.SchemeConfiguration(e);for(var n in this._configuration=t,this.name=t.name,this._collections={},t.collections){t.collections[n];var r=new o.Collection(this,n);this._collections[n]=r}if(s.Elpong.isAutoloadEnabled())for(var n in t.collections)this._collections[n].load(!0)}return e.prototype.configuration=function(){return this._configuration},e.prototype.select=function(e){var t;if(t=this._collections[e])return t;throw new r.ElpongError("collnf",e)},e.prototype.setApiUrl=function(e){var t=l.UrlHelper.trimSlashes(e);return this.api_url=l.UrlHelper.isFqdn(t)?t:"/"+t},e.prototype.getApiUrl=function(){return this.api_url},e.prototype.getCollections=function(){return this._collections},e}();t.Scheme=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n(8),r=n(4),u=n(1),s=n(23),f=n(0),a=n(24),o=function(){function e(e,t){var r=this;this._scheme=e,this.name=t,this.elements=new a.FakeMap,this.new_elements=[],this.default_pre_element={};var n=l.CollectionHelper.getConfiguration(this);for(var o in n.fields){var i=n.fields[o];i.default&&(this.default_pre_element[o]=i.default)}this.actions={getAll:function(e){return s.CollectionActions.executeGetAll(r,e)},getOne:function(e,t){if(void 0===e)throw new f.ElpongError("elenos");return s.CollectionActions.executeGetOne(r,e,t)}},u.Util.forEach(n.collection_actions,function(t,n){r.actions[u.Util.camelize(n)]=function(e){return void 0===e&&(e={}),s.CollectionActions.executeCustom(r,n,t,e)}})}return e.prototype.scheme=function(){return this._scheme},e.prototype.load=function(e){var t=this;if("undefined"==typeof document)throw new f.ElpongError("elndoc");var n=document.querySelectorAll("meta[name=elpong-collection][collection='"+this.name+"'][scheme='"+this.scheme().name+"']"),r=document.querySelectorAll("meta[name=elpong-element][collection='"+this.name+"'][scheme='"+this.scheme().name+"']");if(!e&&!n.length&&!r.length)throw new f.ElpongError("elpnce");for(var o=0,i=u.Util.arrayFromHTML(n);o<i.length;o++)for(var l=i[o],s=0,a=JSON.parse(l.content);s<a.length;s++){var c=a[s];this.buildOrMerge(c)}u.Util.arrayFromHTML(r).map(function(e){return t.buildOrMerge(JSON.parse(e.content))})},e.prototype.configuration=function(){return l.CollectionHelper.getConfiguration(this)},e.prototype.array=function(e){return e||(e={no_new:!1}),(e.no_new?[]:this.new_elements).concat(this.elements.values())},e.prototype.find=function(e){return this.elements.get(e)||null},e.prototype.findBy=function(e,t){var n;t||(t={});for(var r=[],o=0,i=this.array(t);o<i.length;o++){var l=i[o];for(var s in n=!0,e){var a=e[s];if(l.fields[s]!==a){n=!1;break}}if(n){if(!t.multiple)return l;r.push(l)}}return t.multiple?r:null},e.prototype.build=function(e){e||(e=this.default_pre_element);var t=new r.Element(this,e);return l.CollectionHelper.addElement(this,t),t},e.prototype.buildOrMerge=function(e){var t;if(t=e[this.scheme().configuration().selector]){var n=void 0;return(n=this.find(t))?n.merge(e):this.build(e)}return this.build(e)},e}();t.Collection=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),l=n(9),s=n(10);(t.Fields||(t.Fields={})).setup=function(r,e,o){i.Util.forEach(e,function(e,t){if(e.embedded_element)l.EmbeddedElement.handle(r,o,t,e);else if(e.embedded_collection)s.EmbeddedCollection.handle(r,o,t,e);else{if(!o.hasOwnProperty(t))return;var n=o[t];r.fields[t]=n}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(11),i=n(18),l=n(19);(t.Relations||(t.Relations={})).setup=function(n,e){r.Util.forEach(e.has_many,function(e,t){o.HasMany.setup(n,t,e)}),r.Util.forEach(e.has_one,function(e,t){i.HasOne.setup(n,t,e)}),r.Util.forEach(e.belongs_to,function(e,t){l.BelongsTo.setup(n,t,e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n(11),s=n(5),a=n(1);(t.HasOne||(t.HasOne={})).setup=function(e,t,n){var r,o=e.collection(),i=(e.collection().configuration(),o.scheme());return r=n.collection?i.select(n.collection):s.SchemeHelper.getCollectionBySingularName(i,t),e.relations[a.Util.camelize(t)]=function(){return l.HasMany.getHasManyRelationFunction(e,o,n,r,!0)()[0]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),u=n(1),f=n(5);!function(e){(t.BelongsTo||(t.BelongsTo={})).setup=function(e,t,n){var r,o,i=e.collection();if(n.polymorphic){var l=n.collection_field||t+"_collection";r=n.field,e.relations[u.Util.camelize(t)]=function(){return c(e,r,l,t)}}else{var s=i.scheme();o=n.collection?i.scheme().select(n.collection):f.SchemeHelper.getCollectionBySingularName(s,t),r=n.field||t+"_"+s.configuration().selector,e.relations[u.Util.camelize(t)]=function(){return a(e,o,r)}}};var a=function(e,t,n){var r=e.fields[n];return o.isSelectorValue(r)?t.find(r)||null:void 0},c=function(e,t,n,r){var o=e.fields[n],i=e.collection().scheme().select(o);t||(t=r+"_"+e.collection().scheme().configuration().selector);var l=e.fields[t];return i.find(l)||null}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),c=n(1),u=n(0),f=n(12),p=n(3);!function(e){function i(n,r,e){var t;if(void 0===e&&(e={}),n.snapshots.make("before_"+r.toLowerCase()),e.data){if("GET"===r)throw new u.ElpongError("acgtda");t=e.data}else"GET"!==r&&(t=f.ElementHelper.toData(n));if("POST"===r){if(!n.isNew())throw new Error("Element is not new")}else if(n.isNew())throw new Error("Element is new");var o={no_selector:"POST"===r,params:e.params||{}},i=a.Ajax.executeRequest(p.UrlHelper.createForElement(n,o),r,t,e.headers);return i.then(function(e){e.data&&n.merge(e.data),n.snapshots.make("after_"+r.toLowerCase());var t=n.collection();c.Util.includes(t.new_elements,n)&&(c.Util.removeFromArray(t.new_elements,n),t.elements.set(n.selector(),n))}),i}function l(r,e,o,t){void 0===t&&(t={});var n,i=o.method.toUpperCase();if(r.snapshots.make("before_"+e),t.data){if("GET"===i)throw new u.ElpongError("acgtda");n=t.data}else o.no_data||(n=f.ElementHelper.toData(r));var l={suffix:o.path||e,params:t.params||{}};l.no_selector=o.no_selector;var s=a.Ajax.executeRequest(p.UrlHelper.createForElement(r,l),i,n,t.headers);return s.then(function(e){var t;o.returns_other||(e.data&&r.merge(e.data),r.snapshots.make("after_"+i.toLowerCase()));var n=r.collection();if((t=r.selector())&&c.Util.includes(n.new_elements,r))return c.Util.removeFromArray(n.new_elements,r),n.elements.set(t,r)}),s}e.setup=function(r,e){for(var t=function(t){r.actions[t]=function(e){return i(r,t.toUpperCase(),e)}},n=0,o=["get","post","put","delete"];n<o.length;n++)t(o[n]);c.Util.forEach(e,function(t,n){r.actions[c.Util.camelize(n)]=function(e){if(r.isNew()&&!t.no_selector)throw new u.ElpongError("elenew");return l(r,n,t,e)}})},e.execute=i,e.executeCustom=l}(t.Actions||(t.Actions={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),l=n(22),s=n(0);(t.Snapshots||(t.Snapshots={})).setup=function(o){var r=o.snapshots;r.list=[],r.make=function(e){return new l.Snapshot(o,e)},r.lastPersisted=function(){if(!o.isNew())for(var e=r.list.length-1;0<=e;e--){var t=r.list[e];if(i.Util.includes(["after_post","after_put","after_get","creation"],t.tag))return t}},r.lastWithTag=function(e){var t=o.snapshots.list;if(i.Util.isRegExp(e)){for(var n=t.length-1;0<=n;n--)if((r=t[n]).tag&&e.test(r.tag))return r}else for(n=t.length-1;0<=n;n--){var r;if(e===(r=t[n]).tag)return r}},r.last=function(){var e=o.snapshots.list;return e[e.length-1]},r.undo=function(e){if(null==e&&(e=0),i.Util.isInteger(e)){var t=o.snapshots.list;if(e<0||e>t.length)throw new s.ElpongError("elesti",""+e);(n=t[o.snapshots.current_index-e]).revert()}else{var n=void 0;if(!(n=r.lastWithTag(e)))throw new s.ElpongError("elesnf",""+e);n.revert()}return o},r.isPersisted=function(){var e=r.lastPersisted();return!!e&&i.Util.equalsJSON(o.fields,e.data)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=function(){function e(e,t){this.element=e,this.tag=t,this.data=r.ElementHelper.toData(e,!0),this.undone=!1,this.time=Date.now(),this.index=e.snapshots.list.length,e.snapshots.list.push(this),e.snapshots.current_index=this.index}return e.prototype.revert=function(){var e=this.element.snapshots.list;this.element.merge(this.data),this.element.snapshots.current_index=this.index,this.undone=!1;for(var t=this.index+1,n=e.length;t<n;t++)e[t].undone=!0},e}();t.Snapshot=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,l=n(6),s=n(3),i=n(0);(r=t.CollectionActions||(t.CollectionActions={})).executeGetAll=function(t,e){if(void 0===e&&(e={}),e||(e={}),e.data)throw new i.ElpongError("acgtda");var n=l.Ajax.executeRequest(s.UrlHelper.createForCollection(t,{params:e.params||{}}),"GET",void 0,e.headers);return n.then(function(e){e.data.map(function(e){t.buildOrMerge(e)})}),n},r.executeGetOne=function(n,r,e){if(void 0===e&&(e={}),e.data)throw new i.ElpongError("acgtda");var t={suffix:r,params:e.params||{}},o=l.Ajax.executeRequest(s.UrlHelper.createForCollection(n,t),"GET",void 0,e.headers);return o.then(function(e){if(e.data){var t=n.scheme().configuration().selector;if(e.data[t]!==r)throw new i.ElpongError("elesnm",e.data[t]+" != "+r);n.buildOrMerge(e.data)}}),o},r.executeCustom=function(e,t,n,r){r||(r={});var o=r.data,i=n.method.toUpperCase();return l.Ajax.executeRequest(s.UrlHelper.createForCollection(e,{suffix:n.path||t,params:r.params}),i,o,r.headers)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o="undefined"!=typeof Map&&(new Map).values,i=function(){function e(){this.hasRealMap=o,this.map=o?new Map:{}}return e.prototype.get=function(e){return o?this.map.get(e):this.map[e]},e.prototype.set=function(e,t){return o?this.map.set(e,t):this.map[e]=t,this},e.prototype.has=function(e){return o?this.map.has(e):!!this.map[e]},e.prototype.values=function(){return o?Array.from(this.map.values()):r.Util.values(this.map)},e.prototype.delete=function(e){o?this.map.delete(e):delete this.map[e]},e}();t.FakeMap=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=n(0);if(void 0===p)var p=!0;var r=function(e){if(this.name=e.name,p&&!this.name)throw new f.ElpongError("confnn");if(this.selector=e.selector,p&&!this.selector)throw new f.ElpongError("confns",e.name);for(var t in this.collections={},e.collections){for(var n=e.collections[t],r=this.collections[t]={singular:n.singular||t.slice(0,-1)},o=0,i=["fields","relations","actions","collection_actions"];o<i.length;o++){var l=i[o];r[l]=n[l]||{}}var s=void 0;if(s=n.relations)for(var a=0,c=["has_many","has_one","belongs_to"];a<c.length;a++){var u=c[a];s[u]=n.relations[u]||{}}}};t.SchemeConfiguration=r}])});