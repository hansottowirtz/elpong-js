!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("elpong",[],t):"object"==typeof exports?exports.elpong=t():e.elpong=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=24)}([function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();if(Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof o)var o=!0;if(o)var i={schmnf:"Scheme not found",collnf:"Collection not found","collnf:s":"Collection not found by singular name",collex:"Collection with name already exists in scheme",elpgns:"No scheme tags found",elpnce:"No collection or element tags found",confns:"Configuration has no selector",confnn:"Configuration has no name",elenew:"Element is new",elesna:"Element has a selector value but is in new_elements array",elense:"Element has no selector value but is in elements object",apinur:"Api url has not yet been set",fldnsa:"Field should be an array of selectors",elesch:"Element selector changed",elesnf:"Snapshot not found",elesti:"Invalid snapshot identifier: must be number <= list.length, string or RegExp",eleafw:"Pre element has an associated field that does not match the embedded element selector",elesnm:"Selector is not matching get one request selector",ajahct:"Content-Type header not set to application/json"};var l=function(e){function t(t,n){var r=this,l=o?i[t]:t;return r=n?e.call(this,l+": "+n)||this:e.call(this,l)||this}return r(t,e),t}(Error);t.ElpongError=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Util={capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){return e.replace(/_/g," ").replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},removeFromArray:function(e,t){var n=e.indexOf(t);return n!==-1&&(e.splice(n,n+1),!0)},isInteger:function(e){return e===parseInt(e,10)},isNumber:function(e){return isFinite(e)&&!isNaN(parseFloat(e))},isString:function(e){return"string"==typeof e},isRegExp:function(e){return"[object RegExp]"==Object.prototype.toString.call(e)},forEach:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t(r,n)}},endsWith:function(e,t){return e.endsWith?e.endsWith(t):e.substr(-t.length)===t},startsWith:function(e,t){return e.startsWith?e.startsWith(t):e.substr(0,t.length)===t},arrayFromHTML:function(e){return Array.from?Array.from(e):[].slice.call(e)},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e.propertyIsEnumerable(n)&&t.push(e[n]);return t},includes:function(e,t){return e.indexOf(t)>-1},equalsJSON:function(e,n){for(var r in e){var o=e[r],i=n[r];if("object"==typeof o){if(!t.Util.equalsJSON(o,i))return!1}else if(o!==i)return!1}return!0},copyJSON:function(e){return JSON.parse(JSON.stringify(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){function t(e){return e.scheme().configuration().collections[e.name]}function n(e){return t(e).singular}function r(e,t){var n;(n=t.selector())?e.elements[n]=t:e.new_elements.push(t)}e.getConfiguration=t,e.getSingularName=n,e.addElement=r}(r=t.CollectionHelper||(t.CollectionHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0);!function(e){function t(e,t,n,o){o||(o={}),o.Accept=o["Content-Type"]="application/json";var i=JSON.stringify(void 0===n?{}:n),l={method:t,type:t,url:e,data:i,body:i,headers:o,dataType:"json",responseType:"json"};return r(l.url,l)}function n(e,t){switch("undefined"==typeof t&&("undefined"!=typeof jQuery&&e===jQuery.ajax?t="jquery":"undefined"!=typeof fetch&&e===fetch&&(t="fetch")),t){case"jquery":r=function(t,n){var r=jQuery.Deferred(),o=e(t,n);return o.then(function(e,t,n){return r.resolve({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),o["catch"](function(e,t,n){return r.reject({data:e,status:n.statusCode().status,headers:n.getAllResponseHeaders()})}),r.promise()};break;case"fetch":r=function(t,n){return new Promise(function(r,i){n.body="GET"===n.method?void 0:n.data;var l=e(t,n);l.then(function(e){if(204===e.status)r(e);else{var t=e.headers.get("content-type");if(!t||t.indexOf("json")<0)throw new o.ElpongError("ajahct");var n=e.json();n.then(function(t){e.data=t,r(e)}),n["catch"](i)}}),l["catch"](i)})};break;case"angular2":r=function(t,n){return new Promise(function(r,o){n.responseType=void 0,e.request.bind(e)(t,n).subscribe(function(e){if(204===e.status)r(e);else{var t=e.headers.get("content-type");if(!t||t.indexOf("json")<0)throw new Error("ajahct");var n=e.json();e.data=n,r(e)}},function(e){o(e)})})};break;default:r=function(t,n){return e(n)}}}var r;e.executeRequest=t,e.setAjaxFunction=n}(r=t.Ajax||(t.Ajax={}))},function(e,t,n){"use strict";function r(e){return!(!e&&0!==e&&""!==e||"string"!=typeof e&&"number"!=typeof e)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(17),l=n(18),s=n(16),c=n(21),a=n(10),u=n(9),f=n(0);t.isSelectorValue=r;var d=function(){function e(e,t){this.fields={},this.relations={},this.actions={},this.snapshots={},this._collection=e;var n=e.configuration();i.Fields.setup(this,n.fields,t),l.Relations.setup(this,n.relations),s.Actions.setup(this,n.actions),c.Snapshots.setup(this),this.snapshots.make("creation")}return e.prototype.collection=function(){return this._collection},e.prototype.selector=function(){return this.fields[this.collection().scheme().configuration().selector]},e.prototype.remove=function(){var e,t=this;return(e=this.selector())?this.actions["delete"]().then(function(){var n=t.collection().elements;delete n[e]}):(o.Util.removeFromArray(this.collection().new_elements,this),{then:function(e){return e()},"catch":function(){}})},e.prototype.save=function(){return this.isNew()?this.actions.post():this.actions.put()},e.prototype.isNew=function(){if(o.Util.includes(this.collection().new_elements,this)){if(this.selector())throw new f.ElpongError("elesna");return!0}if(this.selector())return!1;throw new f.ElpongError("elense")},e.prototype.merge=function(e){var t=this,n=this.collection().configuration(),i=this.collection().scheme().configuration().selector;return o.Util.forEach(n.fields,function(n,o){var l;if(l=e[o])if(n.embedded_element)a.EmbeddedElement.handle(t,e,o,n);else if(n.embedded_collection)u.EmbeddedCollection.handle(t,e,o,n);else if(o===i){var s=t.fields[o];if(s!==l&&r(s)&&r(l))throw new f.ElpongError("elesch",s+" -> "+l);t.fields[o]=l}else t.fields[o]=l}),this},e}();t.Element=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0),i=n(2);!function(e){function t(e,t){for(var n in e.getCollections()){var r=e.select(n);if(i.CollectionHelper.getSingularName(r)===t)return r}throw new o.ElpongError("collnf:s",t)}e.getCollectionBySingularName=t}(r=t.SchemeHelper||(t.SchemeHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(0);!function(e){function t(t,n,r,i,l){var s,c,a=r.collection(),u=a.scheme(),f=u.getApiUrl();if(!f)throw new o.ElpongError("apinur");return i.path?(s=e.trimSlashes(i.path),c=f+"/"+s):(c=f+"/"+a.name,n.no_selector||l||(c=c+"/"+r.selector())),n.method&&(c=c+"/"+(n.path||t)),i.suffix&&(c=c+"/"+i.suffix),c}function n(e,t,n){var r=t.scheme().getApiUrl();if(!r)throw new o.ElpongError("apinur");var i=r+"/"+t.name;return n.suffix&&(i=i+"/"+n.suffix),i}function r(e){return e.replace(/^\/|\/$/g,"")}function i(e){return/^https?:\/\//.test(e)}e.createForElement=t,e.createForCollection=n,e.trimSlashes=r,e.isFqdn=i}(r=t.UrlHelper||(t.UrlHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(22),i=n(0),l=n(1),s=n(3),c={},a=!1;!function(e){function t(e){var t=new o.Scheme(e);return c[t.name]=t}function n(e){var t;if(t=c[e])return t;throw new i.ElpongError("schmnf",e)}function r(t){if("undefined"!=typeof document){var n=document.querySelectorAll("meta[name=elpong-scheme]");if(!t&&!n.length)throw new i.ElpongError("elpgns");for(var r=0,o=l.Util.arrayFromHTML(n);r<o.length;r++){var s=o[r];e.add(JSON.parse(s.content))}}}function u(e,t){s.Ajax.setAjaxFunction(e,t)}function f(){a=!0,e.load(!0)}function d(){return a}function h(){a=!1,c={}}e.add=t,e.get=n,e.load=r,e.setAjax=u,e.enableAutoload=f,e.isAutoloadEnabled=d,e.tearDown=h}(r=t.Elpong||(t.Elpong={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.UrlHelper=r.UrlHelper;var o=n(2);t.CollectionHelper=o.CollectionHelper},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(4),i=n(1),l=n(2);!function(e){function t(e,t,n,r){var s;if(s=t[n]){var c=e.collection(),a=c.scheme(),u=a.select(r.collection||n);i.Util.forEach(s,function(e){var t=new o.Element(u,e);l.CollectionHelper.addElement(u,t)})}}e.handle=t}(r=t.EmbeddedCollection||(t.EmbeddedCollection={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(5),i=n(0);!function(e){function t(e,t,n,r){var l,s=t[n];if(s){var c=e.collection(),a=c.scheme();l=r.collection?a.select(r.collection):o.SchemeHelper.getCollectionBySingularName(a,n);var u=l.buildOrMerge(s),f=r.field||n+"_"+a.configuration().selector,d=u.selector(),h=t[f];if(h&&h!=d)throw new i.ElpongError("eleafw",h+" != "+d);e.fields[f]=d}}e.handle=t}(r=t.EmbeddedElement||(t.EmbeddedElement={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(2),i=n(1),l=n(0);!function(e){function t(e,t,r){var o=e.collection(),l=(o.configuration(),o.scheme().select(r.collection||t));if(r.inline){var s=r.inline_field||t+"_"+o.scheme().configuration().selector+"s";return e.relations[i.Util.camelize(t)]=function(){return c(e,l,s)}}return e.relations[i.Util.camelize(t)]=n(e,o,r,l)}function n(e,t,n,i,l){var c,a=o.CollectionHelper.getSingularName(t),u=(i.configuration(),t.scheme().configuration().selector);if(n.polymorphic){c=n.as+"_"+u;var f=n.as+"_collection";return function(){return s(e,i,c,f,l)}}return c=n.field?n.field:n.as?n.as+"_"+u:a+"_"+u,function(){return r(e,i,c,l)}}function r(e,t,n,r){for(var o=[],i=e.selector(),l=0,s=t.array();l<s.length;l++){var c=s[l];if(i===c.fields[n]&&(o.push(c),r))return o}return o}function s(e,t,n,r,o){for(var i=[],l=e.selector(),s=e.collection().name,c=0,a=t.array();c<a.length;c++){var u=a[c];if(l===u.fields[n]&&s===u.fields[r]&&(i.push(u),o))return i}return i}function c(e,t,n){var r=e.fields[n];if(!Array.isArray(r))throw new l.ElpongError("fldnrf",n);for(var o=[],s=0,c=t.array();s<c.length;s++){var a=c[s];i.Util.includes(r,a.selector())&&o.push(a)}return o}e.setup=t,e.getHasManyRelationFunction=n}(r=t.HasMany||(t.HasMany={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1);!function(e){function t(e,t){var n=e.collection(),r=n.scheme(),i={},l=r.configuration().collections[n.name].fields;for(var s in l){var c=l[s];if(!(c.no_send||c.embedded_collection||c.embedded_element)){var a=e.fields[s];t&&"object"==typeof a?i[s]=o.Util.copyJSON(a):i[s]=a}}return i}e.toData=t}(r=t.ElementHelper||(t.ElementHelper={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=n(4),i=n(1),l=n(15),s=n(0),c=function(){function e(e,t){var n=this;this._scheme=e,this.name=t,this.elements={},this.new_elements=[],this.default_pre_element={};var o=r.CollectionHelper.getConfiguration(this);for(var s in o.fields){var c=o.fields[s];c["default"]&&(this.default_pre_element[s]=c["default"])}this.actions={getAll:function(e){return l.Actions.executeGetAll(n,e)},getOne:function(e,t){return l.Actions.executeGetOne(n,e,t)}},i.Util.forEach(o.collection_actions,function(e,t){n.actions[i.Util.camelize(t)]=function(r){return l.Actions.executeCustom(n,t,e,r)}})}return e.prototype.scheme=function(){return this._scheme},e.prototype.load=function(e){var t=this;if("undefined"!=typeof document){var n=document.querySelectorAll("meta[name=elpong-collection][collection='"+this.name+"'][scheme='"+this.scheme().name+"']"),r=document.querySelectorAll("meta[name=elpong-element][collection='"+this.name+"'][scheme='"+this.scheme().name+"']");if(!e&&!n.length&&!r.length)throw new s.ElpongError("elpnce");for(var o=0,l=i.Util.arrayFromHTML(n);o<l.length;o++)for(var c=l[o],a=0,u=JSON.parse(c.content);a<u.length;a++){var f=u[a];this.buildOrMerge(f)}i.Util.arrayFromHTML(r).map(function(e){return t.buildOrMerge(JSON.parse(e.content))})}},e.prototype.configuration=function(){return r.CollectionHelper.getConfiguration(this)},e.prototype.array=function(e){e||(e={no_new:!1});var t=e.no_new?[]:this.new_elements;return t.concat(i.Util.values(this.elements))},e.prototype.find=function(e){return this.elements[e]||null},e.prototype.findBy=function(e,t){t||(t={});for(var n,r=this.array(t),o=[],i=0,l=r;i<l.length;i++){var s=l[i];n=!0;for(var c in e){var a=e[c];if(s.fields[c]!==a){n=!1;break}}if(n){if(!t.multiple)return s;o.push(s)}}return t.multiple?o:null},e.prototype.build=function(e){e||(e=this.default_pre_element);var t=new o.Element(this,e);return r.CollectionHelper.addElement(this,t),t},e.prototype.buildOrMerge=function(e){var t;if(t=e[this.scheme().configuration().selector]){var n=void 0;return(n=this.find(t))?n.merge(e):this.build(e)}return this.build(e)},e}();t.Collection=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);if("undefined"==typeof o)var o=!0;var i=function(){function e(e){if(this.name=e.name,o&&!this.name)throw new r.ElpongError("confnn");if(this.selector=e.selector,o&&!this.selector)throw new r.ElpongError("confns",e.name);this.collections={};for(var t in e.collections){for(var n=e.collections[t],i=this.collections[t]={singular:n.singular||t.slice(0,-1)},l=["fields","relations","actions","collection_actions"],s=["has_many","has_one","belongs_to"],c=0,a=l;c<a.length;c++){var u=a[c];i[u]=n[u]||{}}var f=void 0;if(f=n.relations)for(var d=0,h=s;d<h.length;d++){var p=h[d];f[p]=n.relations[p]||{}}}}return e}();t.SchemeConfiguration=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(6),l=n(0);!function(e){function t(e,t){t||(t={});var n=t.data,r=o.Ajax.executeRequest(i.UrlHelper.createForCollection("GET",e,{}),"GET",n,t.headers);return r.then(function(t){t.data.map(function(t){e.buildOrMerge(t)})}),r}function n(e,t,n){n||(n={});var r=n.data,s=o.Ajax.executeRequest(i.UrlHelper.createForCollection("GET",e,{suffix:t}),"GET",r,n.headers);return s.then(function(n){if(n.data){var r=e.scheme().configuration().selector;if(n.data[r]!==t)throw new l.ElpongError("elesnm",n.data[r]+" != "+t);e.buildOrMerge(n.data)}}),s}function r(e,t,n,r){r||(r={});var l=r.data,s=n.method.toUpperCase();return o.Ajax.executeRequest(i.UrlHelper.createForCollection("GET",e,{suffix:n.path||t}),s,l,r.headers)}e.executeGetAll=t,e.executeGetOne=n,e.executeCustom=r}(r=t.Actions||(t.Actions={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(1),l=n(0),s=n(12),c=n(6);!function(e){function t(e,t){for(var o=function(t){e.actions[t]=function(r){return n(e,t.toUpperCase(),r)}},s=0,c=["get","post","put","delete"];s<c.length;s++){var a=c[s];o(a)}i.Util.forEach(t,function(t,n){e.actions[i.Util.camelize(n)]=function(o){if(e.isNew()&&!t.no_selector)throw new l.ElpongError("elenew");return r(e,n,t,o)}})}function n(e,t,n){n||(n={}),e.snapshots.make("before_"+t.toLowerCase());var r;if((r=n.data)?r=n.data:"GET"!==t&&(r=s.ElementHelper.toData(e)),"POST"===t){if(!e.isNew())throw new Error("Element is not new")}else if(e.isNew())throw new Error("Element is new");var l=o.Ajax.executeRequest(c.UrlHelper.createForElement(t,{},e,n.url_options||{},"POST"===t),t,r,n.headers);return l.then(function(n){n.data&&e.merge(n.data),e.snapshots.make("after_"+t.toLowerCase());var r=e.collection();i.Util.includes(r.new_elements,e)&&(i.Util.removeFromArray(r.new_elements,e),r.elements[e.selector()]=e)}),l}function r(e,t,n,r){r||(r={});var l=n.method.toUpperCase();e.snapshots.make("before_"+t);var a;r.data?a=r.data:n.no_data||(a=s.ElementHelper.toData(e));var u=o.Ajax.executeRequest(c.UrlHelper.createForElement(t,n,e,r.url_options||{}),l,a,r.headers);return u.then(function(t){var r;n.returns_other||(t.data&&e.merge(t.data),e.snapshots.make("after_"+l.toLowerCase()));var o=e.collection();if((r=e.selector())&&i.Util.includes(o.new_elements,e))return i.Util.removeFromArray(o.new_elements,e),o.elements[r]=e}),u}e.setup=t,e.execute=n,e.executeCustom=r}(r=t.Actions||(t.Actions={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(10),l=n(9);!function(e){function t(e,t,n){o.Util.forEach(t,function(t,r){if(t.embedded_element)i.EmbeddedElement.handle(e,n,r,t);else if(t.embedded_collection)l.EmbeddedCollection.handle(e,n,r,t);else{if(!n.hasOwnProperty(r))return;var o=n[r];e.fields[r]=o}})}e.setup=t}(r=t.Fields||(t.Fields={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(11),l=n(20),s=n(19);!function(e){function t(e,t){o.Util.forEach(t.has_many,function(t,n){i.HasMany.setup(e,n,t)}),o.Util.forEach(t.has_one,function(t,n){l.HasOne.setup(e,n,t)}),o.Util.forEach(t.belongs_to,function(t,n){s.BelongsTo.setup(e,n,t)})}e.setup=t}(r=t.Relations||(t.Relations={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(4),i=n(1),l=n(5);!function(e){function t(e,t,o){var s,c,a=e.collection();if(o.polymorphic){var u=o.collection_field||t+"_collection";s=o.field,e.relations[i.Util.camelize(t)]=function(){return r(e,s,u,t)}}else{var f=a.scheme();c=o.collection?a.scheme().select(o.collection):l.SchemeHelper.getCollectionBySingularName(f,t),s=o.field||t+"_"+f.configuration().selector,e.relations[i.Util.camelize(t)]=function(){return n(e,c,s)}}}e.setup=t;var n=function(e,t,n){var r=e.fields[n];return o.isSelectorValue(r)?t.find(r)||null:void 0},r=function(e,t,n,r){var o=e.fields[n],i=e.collection().scheme().select(o);if(!t){var l=e.collection().scheme().configuration().selector;t=r+"_"+l}var s=e.fields[t];return i.find(s)||null}}(r=t.BelongsTo||(t.BelongsTo={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(11),i=n(5),l=n(1);!function(e){function t(e,t,n){var r,s=e.collection(),c=(e.collection().configuration(),s.scheme());return r=n.collection?c.select(n.collection):i.SchemeHelper.getCollectionBySingularName(c,t),e.relations[l.Util.camelize(t)]=function(){return o.HasMany.getHasManyRelationFunction(e,s,n,r,!0)()[0]}}e.setup=t}(r=t.HasOne||(t.HasOne={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1),i=n(23),l=n(0);!function(e){function t(e){var t=e.snapshots;t.list=[],t.make=function(t){return new i.Snapshot(e,t)},t.lastPersisted=function(){if(!e.isNew())for(var n=t.list.length-1;n>=0;n--){var r=t.list[n];if(o.Util.includes(["after_post","after_put","after_get","creation"],r.tag))return r}},t.lastWithTag=function(t){var n,r=e.snapshots.list;if(o.Util.isRegExp(t))for(var i=r.length-1;i>=0;i--){var l=r[i];if(l.tag&&t.test(l.tag))return l}else for(var i=r.length-1;i>=0;i--){var l=r[i];if(t===l.tag)return l}return n},t.last=function(){var t=e.snapshots.list;return t[t.length-1]},t.undo=function(n){if(null==n&&(n=0),o.Util.isInteger(n)){var r=e.snapshots.list;if(n<0||n>r.length)throw new l.ElpongError("elesti",""+n);var i=r[e.snapshots.current_index-n];i.revert()}else{var i=void 0;if(!(i=t.lastWithTag(n)))throw new l.ElpongError("elesnf",""+n);i.revert()}return e},t.isPersisted=function(){var n=t.lastPersisted();return!!n&&o.Util.equalsJSON(e.fields,n.data)}}e.setup=t}(r=t.Snapshots||(t.Snapshots={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=n(14),i=n(0),l=n(8),s=n(7),c=function(){function e(e){var t=new o.SchemeConfiguration(e);this._configuration=t,this.name=t.name,this._collections={};for(var n in t.collections){var i=(t.collections[n],new r.Collection(this,n));this._collections[n]=i}if(s.Elpong.isAutoloadEnabled())for(var n in t.collections)this._collections[n].load(!0)}return e.prototype.configuration=function(){return this._configuration},e.prototype.select=function(e){var t;if(t=this._collections[e])return t;throw new i.ElpongError("collnf",e)},e.prototype.setApiUrl=function(e){var t=l.UrlHelper.trimSlashes(e);return this.api_url=l.UrlHelper.isFqdn(t)?t:"/"+t},e.prototype.getApiUrl=function(){return this.api_url},e.prototype.getCollections=function(){return this._collections},e}();t.Scheme=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=function(){function e(e,t){this.element=e,this.tag=t,this.data=r.ElementHelper.toData(e,!0),this.undone=!1,this.time=Date.now(),this.index=e.snapshots.list.length,e.snapshots.list.push(this),e.snapshots.current_index=this.index}return e.prototype.revert=function(){var e=this.element.snapshots.list;this.element.merge(this.data),this.element.snapshots.current_index=this.index,this.undone=!1;for(var t=this.index+1,n=e.length;t<n;t++)e[t].undone=!0},e}();t.Snapshot=o},function(e,t,n){"use strict";var r=n(7);e.exports=r.Elpong}])});